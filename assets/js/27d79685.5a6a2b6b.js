"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7581],{799:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"guides/nat-traversal","title":"NAT Traversal","description":"Configure NAT traversal for Bethrou: understanding NAT, relay node setup, circuit relay configuration, and connecting through firewalls and NAT.","source":"@site/docs/guides/nat-traversal.md","sourceDirName":"guides","slug":"/guides/nat-traversal","permalink":"/docs/guides/nat-traversal","draft":false,"unlisted":false,"editUrl":"https://github.com/bethrou/bethrou/tree/main/docs/docs/guides/nat-traversal.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"NAT Traversal","description":"Configure NAT traversal for Bethrou: understanding NAT, relay node setup, circuit relay configuration, and connecting through firewalls and NAT.","keywords":["NAT traversal","relay nodes","circuit relay","firewall","network traversal","P2P connectivity"],"image":"../../img/bethrou-icon.svg"},"sidebar":"docsSidebar","previous":{"title":"Docker Deployment","permalink":"/docs/guides/deployment-docker"},"next":{"title":"Architecture","permalink":"/docs/concepts/architecture"}}');var l=i(4848),t=i(8453);const s={sidebar_position:5,title:"NAT Traversal",description:"Configure NAT traversal for Bethrou: understanding NAT, relay node setup, circuit relay configuration, and connecting through firewalls and NAT.",keywords:["NAT traversal","relay nodes","circuit relay","firewall","network traversal","P2P connectivity"],image:"../../img/bethrou-icon.svg"},a="NAT Traversal Setup",o={},d=[{value:"Understanding NAT Traversal",id:"understanding-nat-traversal",level:2},{value:"The Problem",id:"the-problem",level:3},{value:"The Solution",id:"the-solution",level:3},{value:"Relay Node Setup",id:"relay-node-setup",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Start Relay Node",id:"start-relay-node",level:3},{value:"Verify Relay",id:"verify-relay",level:3},{value:"Client Configuration",id:"client-configuration",level:2},{value:"Option 1: Explicit Relay",id:"option-1-explicit-relay",level:3},{value:"Option 2: Auto Discovery",id:"option-2-auto-discovery",level:3},{value:"Exit Node Behind NAT",id:"exit-node-behind-nat",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Testing NAT Traversal",id:"testing-nat-traversal",level:2},{value:"1. Deploy Relay",id:"1-deploy-relay",level:3},{value:"2. Start Node (Behind NAT)",id:"2-start-node-behind-nat",level:3},{value:"3. Start Client (Behind NAT)",id:"3-start-client-behind-nat",level:3},{value:"4. Test Connection",id:"4-test-connection",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Relay Trust",id:"relay-trust",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Client cannot connect via relay",id:"client-cannot-connect-via-relay",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"nat-traversal-setup",children:"NAT Traversal Setup"})}),"\n",(0,l.jsx)(n.p,{children:"Guide for configuring NAT traversal using relay nodes."}),"\n",(0,l.jsx)(n.h2,{id:"understanding-nat-traversal",children:"Understanding NAT Traversal"}),"\n",(0,l.jsx)(n.h3,{id:"the-problem",children:"The Problem"}),"\n",(0,l.jsx)(n.p,{children:"Peers behind NAT/firewall cannot accept direct connections:"}),"\n",(0,l.jsx)(n.mermaid,{value:'flowchart LR\n  Client["Client<br/>NAT: 192.168.1.10"]\n  Node["Node<br/>NAT: 10.0.0.5"]\n  Client -.->|Cannot connect directly| Node'}),"\n",(0,l.jsx)(n.h3,{id:"the-solution",children:"The Solution"}),"\n",(0,l.jsx)(n.p,{children:"Use a relay node with public IP:"}),"\n",(0,l.jsx)(n.mermaid,{value:'flowchart LR\n  Client["Client<br/>Behind NAT"] --\x3e|Connect via relay| Relay["Relay<br/>Public IP"]\n  Relay --\x3e|Forwards traffic| Node["Node<br/>Behind NAT"]'}),"\n",(0,l.jsx)(n.h2,{id:"relay-node-setup",children:"Relay Node Setup"}),"\n",(0,l.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Public IP address"}),"\n",(0,l.jsx)(n.li,{children:"Open port (typically 4000)"}),"\n",(0,l.jsx)(n.li,{children:"Sufficient bandwidth"}),"\n",(0,l.jsx)(n.li,{children:"Reliable uptime"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"start-relay-node",children:"Start Relay Node"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"bethrou-node start \\\n  --listen /ip4/0.0.0.0/tcp/4000 \\\n  --relay-mode \\\n  --discover \\\n  --discover-address redis://discovery.example.com:6379 \\\n  --discover-topic bethrou-network\n"})}),"\n",(0,l.jsx)(n.h3,{id:"verify-relay",children:"Verify Relay"}),"\n",(0,l.jsx)(n.p,{children:"Check logs for relay status:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"INFO  Relay mode enabled\nINFO  Listening on: /ip4/0.0.0.0/tcp/4000\n"})}),"\n",(0,l.jsx)(n.p,{children:"Test from outside:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"nc -zv relay-ip 4000\n"})}),"\n",(0,l.jsx)(n.h2,{id:"client-configuration",children:"Client Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"option-1-explicit-relay",children:"Option 1: Explicit Relay"}),"\n",(0,l.jsx)(n.p,{children:"Specify relay in node configuration:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'key: "network.key"\n\nserver:\n  listen: "127.0.0.1:1080"\n  auth: false\n\nrouting:\n  strategy: random\n  health: 30s\n  timeout: 10s\n\nnodes:\n  - id: 12D3KooWNode...\n    relay: /ip4/203.0.113.100/tcp/4000/p2p/12D3KooWRelay...\n\ndiscovery:\n  enabled: false\n\nlog:\n  level: info\n  format: text\n'})}),"\n",(0,l.jsx)(n.h3,{id:"option-2-auto-discovery",children:"Option 2: Auto Discovery"}),"\n",(0,l.jsx)(n.p,{children:"Let libp2p find relay automatically:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'key: "network.key"\n\nserver:\n  listen: "127.0.0.1:1080"\n  auth: false\n\nrouting:\n  strategy: random\n  health: 30s\n  timeout: 10s\n\nnodes: []\n\ndiscovery:\n  enabled: true\n  address: "redis://discovery.example.com:6379"\n  topic: "bethrou-network"\n  timeout: "10s"\n\nlog:\n  level: info\n  format: text\n'})}),"\n",(0,l.jsx)(n.h2,{id:"exit-node-behind-nat",children:"Exit Node Behind NAT"}),"\n",(0,l.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.p,{children:"Exit node connects to relay:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"bethrou-node start \\\n  --listen /ip4/0.0.0.0/tcp/4000 \\\n  --connect-relay /ip4/192.168.0.100/tcp/4000/p2p/12D3KooWRelay...\n"})}),"\n",(0,l.jsx)(n.p,{children:"The node will:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Connect to relay"}),"\n",(0,l.jsx)(n.li,{children:"Accept incoming connections via relay"}),"\n",(0,l.jsx)(n.li,{children:"Forward traffic to clients or hole punch"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"testing-nat-traversal",children:"Testing NAT Traversal"}),"\n",(0,l.jsx)(n.h3,{id:"1-deploy-relay",children:"1. Deploy Relay"}),"\n",(0,l.jsx)(n.p,{children:"On a server with public IP:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"bethrou-node start \\\n  --listen /ip4/0.0.0.0/tcp/4000 \\\n  --relay-mode\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-start-node-behind-nat",children:"2. Start Node (Behind NAT)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"bethrou-node start \\\n  --listen /ip4/0.0.0.0/tcp/4000 \\\n  --connect-relay /ip4/relay-ip/tcp/4000/p2p/12D3KooWRelay...\n"})}),"\n",(0,l.jsx)(n.h3,{id:"3-start-client-behind-nat",children:"3. Start Client (Behind NAT)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'key: "network.key"\n\nserver:\n  listen: "127.0.0.1:1080"\n  auth: false\n\nrouting:\n  strategy: random  \n  health: 30s\n  timeout: 10s\n\nnodes:\n  - id: 12D3KooWNode...\n    relay: /ip4/relay-ip/tcp/4000/p2p/12D3KooWRelay...\n\ndiscovery:\n  enabled: false\n\nlog:\n  level: info\n  format: text\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"4-test-connection",children:"4. Test Connection"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"curl --socks5 127.0.0.1:1080 https://ifconfig.me\n"})}),"\n",(0,l.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,l.jsx)(n.h3,{id:"relay-trust",children:"Relay Trust"}),"\n",(0,l.jsx)(n.p,{children:"Relay can observe:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Connection metadata"}),"\n",(0,l.jsx)(n.li,{children:"Peer IDs and addresses"}),"\n",(0,l.jsx)(n.li,{children:"Connection timing"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Relay cannot observe:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Proxied traffic (encrypted by libp2p)"}),"\n",(0,l.jsx)(n.li,{children:"Destination addresses (handled by exit node)"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Run your own relays"}),": More control and privacy"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Multiple relays"}),": Redundancy and load distribution"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Monitor relay logs"}),": Watch for abuse"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Rate limiting"}),": Prevent resource exhaustion"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Firewall rules"}),": Restrict relay access if needed"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"client-cannot-connect-via-relay",children:"Client cannot connect via relay"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Check relay is running:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"nc -zv relay-ip 4000\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Check logs:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Client\nbethrou-client connect --log-level debug\n\n# Node\nbethrou-node start --log-level debug\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Verify discovery:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"redis-cli PUBSUB CHANNELS bethrou-*\n"})}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/guides/deployment-docker",children:"Docker Deployment"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/guides/configuration",children:"Configuration Guide"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/concepts/security",children:"Security Best Practices"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);